var svg,mouseState,gapWidth,tileSize,gridStart,gridSize,bias,solGrid,currGrid;
function nonogram(){function f(a,b){for(var c in b)a.setAttribute(c,b[c])}function k(a){return document.createElementNS("http://www.w3.org/2000/svg",a)}function g(a){for(var b=0,c=[],d=0;d<a.length;d++)if(1==a[d]&&b++,"0"==a[d]&&0<b||d==a.length-1&&0<b)c.push(b),b=0;0===c.length&&c.push(0);return c}function m(a,b){for(var c=0;c<a.length;c++)"0"==b.getAttribute("flag")?a[c].setAttribute("flag",1):a[c].setAttribute("flag",0);h()}function r(a){for(var b=svg.querySelectorAll("rect[x='"+a.getAttribute("x")+
"']"),c=[],d=0;d<gridSize;d++)c.push(b[d].getAttribute("sol")),a.parentElement.onclick=function(){m(b,a)};return c}function s(a){for(var b=svg.querySelectorAll("rect[y='"+a.getAttribute("y")+"']"),c=[],d=0;d<gridSize;d++)c.push(b[d].getAttribute("sol")),a.parentElement.onclick=function(){m(b,a)};return c}function n(a,b,c){var d=svg.appendChild(k("g")),e=d.appendChild(k("rect")),d=d.appendChild(k("text"));f(e,{x:a,y:b,width:2*tileSize-gapWidth,height:tileSize,fill:"#eaeaea",transform:"rotate("+c+","+
a+",0)",flag:0});f(d,{x:a+gapWidth,y:b+tileSize/2+gapWidth,transform:"rotate("+c+","+a+",0)"});"0"==e.getAttribute("x")?d.textContent=g(s(e)):d.textContent=g(r(e))}function h(){for(var a=document.querySelectorAll("svg>rect"),b=0;b<a.length;b++)currGrid[b]=a[b].getAttribute("curr");currGrid.toString()==solGrid.toString()&&alert("Win")}function p(){var a=event.target;1==a.getAttribute("curr")?f(a,{curr:0,flag:1}):1==a.getAttribute("flag")?a.setAttribute("flag",0):a.setAttribute("flag",1);h()}function q(){var a=
event.target;1==a.getAttribute("curr")?f(a,{curr:0,flag:0}):a.setAttribute("curr",1);h()}function t(){0===event.button?q():2===event.button&&p()}function u(){!0===mouseState&&0===event.button?q():!0===mouseState&&2===event.button&&p()}svg=document.getElementById("svgElement");mouseState=!1;gapWidth=5;tileSize=35;gridStart=2*tileSize;gridSize=5;bias=.75;solGrid=[];currGrid=[];(function(){document.onmousedown=function(){mouseState=!0};document.onmouseup=function(){mouseState=!1};document.oncontextmenu=
function(){return!1};svg.style.width=svg.style.height=gridStart+(tileSize+gapWidth)*gridSize})();(function(){for(var a=0,b=0,c=0;a<gridSize*gridSize;a++,b++){b==gridSize&&(b=0);0!==a&&0===a%gridSize&&c++;solGrid[a]=Math.round(Math.pow(Math.random(),bias)).toString();var d=b*(tileSize+gapWidth),e=c*(tileSize+gapWidth),h=solGrid[a],l=void 0,g=k("rect");l||(l="#eaeaea");f(g,{x:d+gridStart,y:e+gridStart,width:tileSize,height:tileSize,sol:h,curr:0,flag:0,fill:l});svg.appendChild(g)}})();(function(){for(var a=
0;a<gridSize;a++)n(a*(tileSize+gapWidth)+gridStart,-tileSize,90),n(0,a*(tileSize+gapWidth)+gridStart,0)})();(function(){for(var a=document.querySelectorAll("svg>rect"),b=0;b<a.length;b++)a[b].onmousedown=t,a[b].onmouseover=u})()}document.onreadystatechange=function(){"complete"==document.readyState&&nonogram()};