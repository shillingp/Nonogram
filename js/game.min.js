function nonogram(){function t(t,e){for(var r in e)t.setAttribute(r,e[r])}function e(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function r(r,i,n){var o=e("rect");t(o,{x:r+gridStart,y:i+gridStart,width:tileSize,height:tileSize,sol:n,curr:0,flag:0,fill:"#eaeaea"}),svg.appendChild(o)}function i(){for(var t=0,e=0,i=0;gridSize*gridSize>t;t++,e++)e==gridSize&&(e=0),0!==t&&t%gridSize===0&&i++,solGrid[t]=Math.round(Math.pow(Math.random(),bias)).toString(),r(e*(tileSize+gapWidth),i*(tileSize+gapWidth),solGrid[t])}function n(){for(;svg.firstChild;)svg.removeChild(svg.firstChild)}function o(t){for(var e=0,r=[],i=0;i<t.length;i++)1==t[i]&&e++,("0"==t[i]&&e>0||i==t.length-1&&e>0)&&(r.push(e),e=0);return 0===r.length&&r.push(0),r}function u(t,e){for(var r=0;r<t.length;r++)"0"==e.getAttribute("flag")?t[r].setAttribute("flag",1):t[r].setAttribute("flag",0);c()}function a(t){for(var e=svg.querySelectorAll("rect[x='"+t.getAttribute("x")+"']"),r=[],i=0;gridSize>i;i++)r.push(e[i].getAttribute("sol")),t.parentElement.onclick=function(){u(e,t)};return r}function g(t){for(var e=svg.querySelectorAll("rect[y='"+t.getAttribute("y")+"']"),r=[],i=0;gridSize>i;i++)r.push(e[i].getAttribute("sol")),t.parentElement.onclick=function(){u(e,t)};return r}function l(r,i,n){var u=svg.appendChild(e("g")),l=u.appendChild(e("rect")),d=u.appendChild(e("text"));t(l,{x:r,y:i,width:2*tileSize-gapWidth,height:tileSize,fill:"#eaeaea",transform:"rotate("+n+","+r+",0)",flag:0}),t(d,{x:r+gapWidth,y:i+tileSize/2+gapWidth,transform:"rotate("+n+","+r+",0)"}),d.textContent=o("0"==l.getAttribute("x")?g(l):a(l))}function d(){for(var t=function(t){return t*(tileSize+gapWidth)+gridStart},e=0;gridSize>e;e++)l(t(e),-tileSize,90),l(0,t(e),0)}function c(){for(var t=document.querySelectorAll("svg>rect"),e=0;e<t.length;e++)currGrid[e]=t[e].getAttribute("curr");currGrid.toString()==solGrid.toString()&&(document.getElementById("svgBanner").style.visibility="visible")}function s(){var e=event.target;1==e.getAttribute("curr")?t(e,{curr:0,flag:1}):1==e.getAttribute("flag")?e.setAttribute("flag",0):e.setAttribute("flag",1),c()}function f(){var e=event.target;1==e.getAttribute("curr")?t(e,{curr:0,flag:0}):e.setAttribute("curr",1),c()}function v(){0===event.button?f():2===event.button&&s()}function h(){mouseState===!0&&0===event.button?f():mouseState===!0&&2===event.button&&s()}function S(){for(var t=document.querySelectorAll("svg>rect"),e=0;e<t.length;e++)t[e].onmousedown=v,t[e].onmouseover=h,t[e].addEventListener("touchstart",m,!1),t[e].addEventListener("touchend",m,!1)}function m(){var t="";switch(event.type){case"touchstart":t="mousedown";break;case"touchend":t="mouseup";break;default:return}}function p(){document.onmousedown=function(){mouseState=!0},document.onmouseup=function(){mouseState=!1},svg.parentElement.oncontextmenu=function(){return!1};var e=gridStart+(tileSize+gapWidth)*gridSize;svg.style.maxWidth=svg.style.maxHeight=e,t(svg,{viewBox:"0,0,"+e+","+e,preserveAspectRatio:"xMidYMid meet"});var r=document.getElementById("svgBanner");r.onclick=function(){nonogram()},r.style.visibility="hidden"}function b(){p(),n(),i(),d(),S()}svg=document.getElementById("svgElement"),mouseState=!1,gapWidth=5,tileSize=35,gridStart=2*tileSize,gridSize=10,bias=.75,solGrid=[],currGrid=[],b()}var svg,mouseState,gapWidth,tileSize,gridStart,gridSize,bias,solGrid,currGrid;document.onreadystatechange=function(){"complete"==document.readyState&&nonogram()};