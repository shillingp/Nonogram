var svg=document.getElementById("svgElement"),mouseState=!1,gapWidth=5,tileSize=35,gridStart=2*tileSize,gridSize=10,bias=.75,solGrid=[],currGrid=[];function setAttributes(a,b){for(var c in b)a.setAttribute(c,b[c])}function svgCreate(a){return document.createElementNS("http://www.w3.org/2000/svg",a)}function drawTile(a,b,c,d){var e=svgCreate("rect");d||(d="#eaeaea");setAttributes(e,{x:a+gridStart,y:b+gridStart,width:tileSize,height:tileSize,sol:c,curr:0,flag:0,fill:d});svg.appendChild(e)}
function drawGrid(){for(var a=0,b=0,c=0;a<gridSize*gridSize;a++,b++)b==gridSize&&(b=0),0!==a&&0===a%gridSize&&c++,solGrid[a]=Math.round(Math.pow(Math.random(),bias)).toString(),drawTile(b*(tileSize+gapWidth),c*(tileSize+gapWidth),solGrid[a])}function islandCalc(a){for(var b=0,c=[],d=0;d<a.length;d++)if(1==a[d]&&b++,!1==a[d]&&0<b||d==a.length-1&&0<b)c.push(b),b=0;0===c.length&&c.push(0);return c}
function flagWrite(a,b){for(var c=0;c<a.length;c++)0==b.getAttribute("flag")?a[c].setAttribute("flag",1):a[c].setAttribute("flag",0);update()}function horzText(a){for(var b=svg.querySelectorAll("rect[x='"+a.getAttribute("x")+"']"),c=[],d=0;d<gridSize;d++)c.push(b[d].getAttribute("sol")),a.parentElement.onclick=function(){flagWrite(b,a)};return c}
function vertText(a){for(var b=svg.querySelectorAll("rect[y='"+a.getAttribute("y")+"']"),c=[],d=0;d<gridSize;d++)c.push(b[d].getAttribute("sol")),a.parentElement.onclick=function(){flagWrite(b,a)};return c}
function solTile(a,b,c){var d=svg.appendChild(svgCreate("g")),e=d.appendChild(svgCreate("rect")),d=d.appendChild(svgCreate("text"));setAttributes(e,{x:a,y:b,width:2*tileSize-gapWidth,height:tileSize,fill:"#eaeaea",transform:"rotate("+c+","+a+",0)",flag:0});setAttributes(d,{x:a+gapWidth,y:b+tileSize/2+gapWidth,transform:"rotate("+c+","+a+",0)"});0==e.getAttribute("x")?d.textContent=islandCalc(vertText(e)):d.textContent=islandCalc(horzText(e))}
function writeClues(){for(var a=0;a<gridSize;a++)solTile(a*(tileSize+gapWidth)+gridStart,-tileSize,90),solTile(0,a*(tileSize+gapWidth)+gridStart,0)}function update(){for(var a=document.querySelectorAll("svg>rect"),b=0;b<a.length;b++)currGrid[b]=a[b].getAttribute("curr");currGrid.toString()==solGrid.toString()&&alert("Win")}
function toggleFlag(){var a=event.target;1==a.getAttribute("curr")?setAttributes(a,{curr:0,flag:1}):1==a.getAttribute("flag")?a.setAttribute("flag",0):a.setAttribute("flag",1);update()}function toggleTile(){var a=event.target;1==a.getAttribute("curr")?setAttributes(a,{curr:0,flag:0}):a.setAttribute("curr",1);update()}document.onmousedown=function(){mouseState=!0};document.onmouseup=function(){mouseState=!1};function mouseClick(){0===event.button&&toggleTile();2===event.button&&toggleFlag()}
function mouseDrag(){!0===mouseState&&0===event.button&&toggleTile();!0===mouseState&&2===event.button&&toggleFlag()}function mouseEvent(){for(var a=document.querySelectorAll("svg>rect"),b=0;b<a.length;b++)a[b].onmousedown=mouseClick,a[b].onmouseover=mouseDrag;document.oncontextmenu=function(){return!1}}function gameManager(){drawGrid();writeClues();mouseEvent()}gameManager();
